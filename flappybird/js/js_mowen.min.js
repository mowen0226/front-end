function BirdClass(a,b,c,d){this.w=a,this.h=b,this.x=c,this.y=d,this.o=$('<div id="birdBox" style="width:'+this.w+"px;height:"+this.h+"px;left:"+this.x+"px; top:"+this.y+'px"></div>'),this.speedY=0,this.rotate=0,this.state=1,this.o.appendTo("#birdContainer")}function Tube(a){this.basicBlockHeight=55,this.emptyBlockNumber=3,this.grade=a,this.x=STAGE_W,this.y=this.grade*this.basicBlockHeight,this.w=69,this.h=this.emptyBlockNumber*this.basicBlockHeight,this.oTube1=$('<div class="tubeBox" style="background-position:left bottom;width:'+this.w+"px;height:"+this.y+"px;left:"+this.x+'px; top:0px"></div>').appendTo("#birdContainer"),this.oTube2=$('<div class="tubeBox" style="background-position:left top;width:'+this.w+"px;height:"+(STAGE_H-this.h-this.y)+"px;left:"+this.x+"px; top:"+(this.h+this.y)+'px"></div>').appendTo("#birdContainer")}function myAddEvent(a,b,c){a.attachEvent?a.attachEvent("on"+b,function(){return 0==c.call(a)?(event.cancelBubble=!0,!1):void 0}):a.addEventListener(b,function(b){return 0==c.call(a)?(b.preventDefault(),!1):void 0},!1)}for(var FPS=30,SCORE=0,SCORE_HIGHEST=0,STAGE_W=960,STAGE_H=570,STAGE_X=0,BIRD_FIRST_X=200,BIRD_FIRST_Y=200,BIRD_WIDTH=45,BIRD_HEIGHT=40,STAGE_SPEED_X=8,TUBE_DATA=[3,6,3,5,1,6,1,3,2,3,6,1,5,6,1,4,2,3,5,1,3,6,3,5,1,6,1,3,2,3,6,1,5,6,1,4,2,3,5,1,3,6,3,5,1,6,1,3,2,3,6,1,5,6,1,4,2,3,5,1,3,6,3,5,1,6,1,3,2,3,6,1,5,6,1,4,2,3,5,1,3,6,3,5,1,6,1,3,2,3,6,1,5,6,1,4,2,3,5,1,3,6,3,5,1,6,1,3,2,3,6,1,5,6,1,4,2,3,5,1,3,6,3,5,1,6,1,3,2,3,6,1,5,6,1,4,2,3,5,1,3,6,3,5,1,6,1,3,2,3,6,1,5,6,1,4,2,3,5,1,3,6,3,5,1,6,1,3,2,3,6,1,5,6,1,4,2,3,5,1,3,6,3,5,1,6,1,3,2,3,6,1,5,6,1,4,2,3,5,1],TUBE_STAGE=[],TUBE_DATA_X=[],i=0;i<TUBE_DATA.length;i++)TUBE_DATA_X.push(STAGE_W+40*STAGE_SPEED_X*i);var TUBE_DATA_X_INDEX=0;BirdClass.prototype.fly=function(){this.speedY+=2,this.y+=this.speedY,this.rotate+=3,STAGE_X+=STAGE_SPEED_X,this.y>=STAGE_H-BIRD_HEIGHT&&(this.y=STAGE_H-BIRD_HEIGHT,this.state=0),this.o[0].style.top=this.y+"px",this.o.css({transform:"rotate("+this.rotate+"deg)","-webkit-transform":"rotate("+this.rotate+"deg)","-moz-transform":"rotate("+this.rotate+"deg)","-ms-transform":"rotate("+this.rotate+"deg)"})},BirdClass.prototype.tip=function(){this.speedY=-17,this.rotate=-20},Tube.prototype.move=function(a){this.x-=a,this.oTube1.css("left",this.x),this.oTube2.css("left",this.x)},Tube.prototype.release=function(){this.oTube1.remove(),this.oTube2.remove()},$(document).ready(function(){function d(){function f(a){a.preventDefault()}function g(){document.removeEventListener("touchmove",f,!1),document.removeEventListener("touchend",g,!1)}myAddEvent(document,"mousedown",function(){c.tip()});var d=document.getElementById("birdContainer");myAddEvent(d,"touchstart",function(){c.tip(),document.addEventListener("touchmove",f,!1),document.addEventListener("touchend",g,!1)}),clearInterval(a),a=setInterval(function(){STAGE_X+STAGE_W==TUBE_DATA_X[TUBE_DATA_X_INDEX]&&(TUBE_STAGE[TUBE_DATA_X_INDEX%4]&&(TUBE_STAGE[TUBE_DATA_X_INDEX%4].release(),TUBE_STAGE[TUBE_DATA_X_INDEX%4]=null),TUBE_STAGE[TUBE_DATA_X_INDEX%4]=new Tube(TUBE_DATA[TUBE_DATA_X_INDEX]),TUBE_DATA_X_INDEX++),c.fly();for(i in TUBE_STAGE)TUBE_STAGE[i].move(STAGE_SPEED_X);b.html(SCORE),TUBE_STAGE[SCORE%4]?(BIRD_FIRST_X+BIRD_WIDTH>=TUBE_STAGE[SCORE%4].x&&BIRD_FIRST_X<=TUBE_STAGE[SCORE%4].x+TUBE_STAGE[SCORE%4].w?(c.y<=TUBE_STAGE[SCORE%4].y||c.y+BIRD_HEIGHT>=TUBE_STAGE[SCORE%4].y+TUBE_STAGE[SCORE%4].h||0==c.state)&&e():0==c.state&&e(),TUBE_STAGE[SCORE%4].x+TUBE_STAGE[SCORE%4].w<BIRD_FIRST_X&&(SCORE++,SCORE==TUBE_DATA.length&&alert("\u4f60\u901a\u5173\u4e86"))):0==c.state&&e()},FPS)}function e(){return clearInterval(a),SCORE>SCORE_HIGHEST&&(SCORE_HIGHEST=SCORE),$("#scoreHighest").html("<p>\u672c\u8f6e\u5f97\u5206:"+SCORE+"</p><p>\u5386\u53f2\u6700\u9ad8\u5206\uff1a"+SCORE_HIGHEST+"</p>"),$("#restart").show(),$("#restartBtn").click(function(){$("#restart").hide(),f()}),!1}function f(){STAGE_X=0,SCORE=0,TUBE_DATA_X_INDEX=0,c.state=1,$("#birdContainer .tubeBox").remove(),TUBE_STAGE.length=0,c.y=BIRD_FIRST_Y,d()}var a=!1,b=$("#score"),c=new BirdClass(BIRD_WIDTH,BIRD_HEIGHT,BIRD_FIRST_X,BIRD_FIRST_Y);$("#start").click(function(){$("#score").show(),$(this).hide(),d()})});